<%
  const isImageType = content && content.type === "image";
  const hasUploadedImage = isImageType && content && content.value && content.value.startsWith("/uploads/");
  const nonTextValue = content && content.value ? content.value : "";
  const regularValuePrefill = isImageType ? "" : nonTextValue;
%>
<div class="admin-section-card">
  <h3>Titre du site</h3>
  <div class="form-group compact">
    <label class="visually-hidden">Titre du site</label>
    <input type="text" name="title" value="<%= content && content.title ? content.title : '' %>" placeholder="Qr Dynamic" />
  </div>
</div>

<div class="admin-section-card">
  <div class="section-header-with-config">
    <h3>Contenu</h3>
    <div class="config-dropdown-wrapper">
      <button type="button" class="config-icon-button" id="cardCustomizationToggle" aria-label="Personnalisation de la carte" aria-expanded="false">
        ‚öôÔ∏è
      </button>
      <div class="config-dropdown" id="cardCustomizationDropdown">
        <div class="config-dropdown-content">
          <h4>Personnalisation de la carte</h4>
          <div class="form-group">
            <label>Couleur de fond de la carte</label>
            <div class="color-controls">
              <input type="color" name="cardBackgroundColor" id="cardBackgroundColor" value="<%= content && content.cardBackgroundColor && content.cardBackgroundColor.startsWith('#') ? content.cardBackgroundColor : '#ffffff' %>" />
              <div class="color-input-wrapper">
                <input type="text" name="cardBackgroundColorValue" id="cardBackgroundColorText" value="<%= content && content.cardBackgroundColor ? content.cardBackgroundColor : '#ffffff' %>" placeholder="#ffffff ou rgba(255,255,255,0.5)" />
              </div>
            </div>
            <div class="opacity-control">
              <label>Opacit√©</label>
              <input type="range" id="cardBackgroundOpacity" min="0" max="100" value="100" />
              <span id="cardBackgroundOpacityValue" class="opacity-value">100%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="form-group compact">
    <label class="visually-hidden">Type de contenu</label>
    <select name="type" id="contentType">
      <option value="text" <%= content && content.type==="text"?"selected":"" %>>Texte</option>
      <option value="image" <%= isImageType ? "selected" : "" %>>Image</option>
      <option value="video" <%= content && content.type==="video"?"selected":"" %>>Vid√©o YouTube (URL ou embed)</option>
      <option value="embed" <%= content && content.type==="embed"?"selected":"" %>>Playlist Spotify (URL ou embed)</option>
    </select>
  </div>
  
  <div class="form-group">
    <label class="visually-hidden">Contenu</label>
    
    <div id="textEditorContainer" class="<%= content && content.type==="text" ? "" : "hidden" %>">
      <div id="textEditor"></div>
    </div>
    
    <div id="nonTextValueSection" class="<%= content && content.type==="text" ? "hidden" : "" %>">
      <div id="regularValueGroup" class="<%= isImageType ? "hidden" : "" %>">
        <input
          type="text"
          id="regularValue"
          value="<%= regularValuePrefill %>"
          placeholder="<%= content && content.type==='video' ? 'URL YouTube ou code embed' : 'Collez le lien ou le code embed' %>"
        />
        <small id="regularValueHelper" class="helper">
          <%= content && content.type==='video'
            ? "Collez un lien YouTube ou un code d'int√©gration (iframe)."
            : "Collez le lien public ou le code d'int√©gration du contenu." %>
        </small>
      </div>
      
      <div id="imageUploadGroup" class="admin-upload <%= isImageType ? "" : "hidden" %>" data-upload-field="content-image">
        <label class="sub-label">Image du site</label>
        <div class="admin-upload__controls">
          <button type="button" class="btn-upload" data-upload-trigger>üìÅ S√©lectionner une image</button>
          <input type="file" name="contentImageFile" id="contentImageFile" accept="image/png,image/jpeg,image/gif,image/webp" hidden data-upload-input />
        </div>
        <div class="admin-upload__dropzone" data-upload-dropzone>
          <div class="admin-upload__icon">üñºÔ∏è</div>
          <p><strong>Glissez-d√©posez</strong> une image ici ou utilisez le bouton ci-dessus.</p>
          <small>Formats accept√©s : PNG, JPG, GIF, WEBP. Taille conseill√©e : &lt; 5 Mo.</small>
        </div>
        <small>Votre image est automatiquement optimis√©e et h√©berg√©e sur nos serveurs.</small>
        
        <div class="preview-section admin-upload__preview hidden" data-upload-preview>
          <p>Aper√ßu du fichier s√©lectionn√©</p>
          <img alt="Pr√©visualisation de l'image" class="preview-large" data-upload-preview-img />
        </div>
        
        <% if (hasUploadedImage) { %>
          <div class="preview-section">
            <p>Image actuelle</p>
            <img src="<%= content.value %>" alt="Image actuelle" class="preview-large" />
          </div>
        <% } %>
      </div>
    </div>
    
    <input type="hidden" name="value" id="finalValue" />
  </div>
</div>

