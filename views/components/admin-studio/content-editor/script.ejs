<!-- Content Editor - Éditeur de contenu (Quill, types de contenu) -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
(function() {
  if (typeof window.AdminStudio === 'undefined') {
    window.AdminStudio = {};
  }

  const previewState = window.AdminStudio.previewState;
  const syncState = window.AdminStudio.syncState;

  if (!previewState || !syncState) return;

  const quill = new Quill('#textEditor', {
    theme: 'snow',
    modules: {
      toolbar: [
        [{ 'header': [1, 2, 3, false] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],
        [{ 'color': [] }, { 'background': [] }],
        [{ 'align': [] }],
        ['link'],
        ['clean']
      ]
    },
    placeholder: 'Saisissez votre texte ici...'
  });

  if (previewState.type === 'text' && previewState.value) {
    quill.root.innerHTML = previewState.value;
  }

  quill.on('text-change', function() {
    if (document.getElementById('contentType')?.value === 'text') {
      syncState('value', quill.root.innerHTML);
    }
  });

  const contentTypeSelect = document.getElementById('contentType');
  const textEditorContainer = document.getElementById('textEditorContainer');
  const nonTextValueSection = document.getElementById('nonTextValueSection');
  const imageUploadGroup = document.getElementById('imageUploadGroup');
  const regularValueGroup = document.getElementById('regularValueGroup');
  const regularValueInput = document.getElementById('regularValue');
  const regularValueHelper = document.getElementById('regularValueHelper');
  const titleInput = document.querySelector('input[name="title"]');

  function updateValueInputs() {
    if (!contentTypeSelect) return;
    const currentType = contentTypeSelect.value;
    const isText = currentType === 'text';
    const isImage = currentType === 'image';

    textEditorContainer?.classList.toggle('hidden', !isText);
    nonTextValueSection?.classList.toggle('hidden', isText);
    regularValueGroup?.classList.toggle('hidden', isText || isImage);
    imageUploadGroup?.classList.toggle('hidden', !isImage);

    if (regularValueInput) {
      if (isImage) {
        regularValueInput.placeholder = '';
      } else if (currentType === 'video') {
        regularValueInput.placeholder = 'URL YouTube ou code embed';
      } else if (currentType === 'embed') {
        regularValueInput.placeholder = 'Collez l\'URL ou l\'iframe du service externe';
      } else {
        regularValueInput.placeholder = 'Collez la valeur du contenu';
      }
    }

    if (regularValueHelper) {
      if (currentType === 'video') {
        regularValueHelper.textContent = 'Collez un lien YouTube ou un code d\'intégration (iframe).';
      } else if (currentType === 'embed') {
        regularValueHelper.textContent = 'Collez l\'URL ou l\'iframe fourni par le service externe.';
      } else {
        regularValueHelper.textContent = 'Collez la valeur publique à afficher (URL, identifiant, etc.).';
      }
    }

    syncState('type', currentType);
    if (!isText && regularValueInput && !isImage) {
      syncState('value', regularValueInput.value || '');
    } else if (isText) {
      syncState('value', quill.root.innerHTML);
    }
  }

  regularValueInput?.addEventListener('input', function(e) {
    if (contentTypeSelect?.value !== 'text' && contentTypeSelect?.value !== 'image') {
      syncState('value', e.target.value);
    }
  });

  contentTypeSelect?.addEventListener('change', updateValueInputs);
  updateValueInputs();

  titleInput?.addEventListener('input', function(e) {
    syncState('title', e.target.value || '');
  });

  // Exposer quill pour le form-handler
  window.AdminStudio.quill = quill;
  window.AdminStudio.contentTypeSelect = contentTypeSelect;
  window.AdminStudio.regularValueInput = regularValueInput;
})();
</script>

