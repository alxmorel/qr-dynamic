<!-- URL Normalizer - Normalisation des URLs YouTube et Spotify -->
<script>
(function() {
  if (typeof window.AdminStudio === 'undefined') {
    window.AdminStudio = {};
  }

  function normalizeYoutubeUrl(value) {
    if (!value) return '';
    if (value.includes('<iframe')) return value;
    try {
      if (value.includes('youtube.com') || value.includes('youtu.be')) {
        const url = new URL(value);
        if (url.hostname === 'youtu.be') {
          return `https://www.youtube.com/embed/${url.pathname.replace('/', '')}`;
        }
        if (url.searchParams.get('v')) {
          return `https://www.youtube.com/embed/${url.searchParams.get('v')}`;
        }
        if (url.pathname.startsWith('/embed/')) {
          return value;
        }
      }
    } catch (_) {
      return value;
    }
    return value;
  }

  function normalizeSpotifyUrl(value) {
    if (!value) return '';
    if (value.includes('open.spotify.com/embed/')) {
      return value;
    }
    try {
      const match = value.match(/open\.spotify\.com\/(?:intl-[^\/]+\/)?(album|playlist|track)\/([^?&]+)/);
      if (match) {
        const type = match[1];
        const id = match[2];
        return `https://open.spotify.com/embed/${type}/${id}?utm_source=generator`;
      }
    } catch (_) {
      return value;
    }
    return value;
  }

  window.AdminStudio.normalizeYoutubeUrl = normalizeYoutubeUrl;
  window.AdminStudio.normalizeSpotifyUrl = normalizeSpotifyUrl;
})();
</script>

