<!-- Color Controls - Contrôles de couleur (background, card) -->
<script>
(function() {
  if (typeof window.AdminStudio === 'undefined') {
    window.AdminStudio = {};
  }

  const syncState = window.AdminStudio.syncState;

  if (!syncState) return;

  // Contrôle de la couleur de fond
  const backgroundColorInput = document.getElementById('backgroundColor');
  const backgroundColorText = document.getElementById('backgroundColorText');

  function setBackgroundColor(value) {
    syncState('backgroundColor', value);
  }

  backgroundColorInput?.addEventListener('input', function() {
    backgroundColorText.value = this.value;
    setBackgroundColor(this.value);
  });

  backgroundColorText?.addEventListener('input', function() {
    const value = this.value.trim();
    syncState('backgroundColor', value);
    if (/^#[0-9A-F]{6}$/i.test(value) && backgroundColorInput) {
      backgroundColorInput.value = value;
    }
  });

  // Contrôle de la couleur de la carte
  const cardBackgroundColorInput = document.getElementById('cardBackgroundColor');
  const cardBackgroundColorText = document.getElementById('cardBackgroundColorText');
  const cardBackgroundOpacity = document.getElementById('cardBackgroundOpacity');
  const cardBackgroundOpacityValue = document.getElementById('cardBackgroundOpacityValue');

  function hexToRgba(hex, alpha = 1) {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  }

  function rgbaToHex(rgba) {
    const match = rgba.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
      const r = parseInt(match[1]).toString(16).padStart(2, '0');
      const g = parseInt(match[2]).toString(16).padStart(2, '0');
      const b = parseInt(match[3]).toString(16).padStart(2, '0');
      return `#${r}${g}${b}`;
    }
    return null;
  }

  function updateCardColor() {
    const hex = cardBackgroundColorInput?.value || '#ffffff';
    const alpha = (cardBackgroundOpacity?.value || 100) / 100;
    const rgba = hexToRgba(hex, alpha);
    if (cardBackgroundColorText) {
      cardBackgroundColorText.value = rgba;
    }
    if (cardBackgroundOpacityValue && cardBackgroundOpacity) {
      cardBackgroundOpacityValue.textContent = `${cardBackgroundOpacity.value}%`;
    }
    syncState('cardBackgroundColor', rgba);
  }

  if (cardBackgroundColorText?.value?.startsWith('rgba')) {
    const rgba = cardBackgroundColorText.value;
    const hex = rgbaToHex(rgba);
    if (hex && cardBackgroundColorInput) {
      cardBackgroundColorInput.value = hex;
    }
    const alphaMatch = rgba.match(/rgba\([^)]+,\s*([\d.]+)\)/);
    if (alphaMatch && cardBackgroundOpacity) {
      cardBackgroundOpacity.value = Math.round(parseFloat(alphaMatch[1]) * 100);
      cardBackgroundOpacityValue.textContent = `${cardBackgroundOpacity.value}%`;
    }
  } else if (cardBackgroundOpacityValue && cardBackgroundOpacity) {
    cardBackgroundOpacityValue.textContent = `${cardBackgroundOpacity.value}%`;
  }

  cardBackgroundColorInput?.addEventListener('input', updateCardColor);
  cardBackgroundOpacity?.addEventListener('input', updateCardColor);

  cardBackgroundColorText?.addEventListener('input', function() {
    const value = this.value.trim();
    syncState('cardBackgroundColor', value);
    if (value.startsWith('rgba')) {
      const hex = rgbaToHex(value);
      if (hex && cardBackgroundColorInput) {
        cardBackgroundColorInput.value = hex;
      }
    }
  });

  updateCardColor();
})();
</script>

